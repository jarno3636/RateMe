/* /app/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ───────────────────────── Base theme tokens ───────────────────────── */
:root {
  /* Surfaces & text */
  --bg: #0b0b0f;
  --panel: rgba(255,255,255,0.05);
  --panel-strong: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.10);
  --border-strong: rgba(255,255,255,0.16);
  --fg: #e5e7eb;       /* zinc-200 */
  --muted: #a1a1aa;    /* zinc-400 */

  /* Brand & states */
  --primary: #ec4899;  /* pink-500 */
  --primary-weak: rgba(236,72,153,0.12);
  --focus: rgba(236,72,153,0.55);
  --success: #22c55e;  /* green-500 */
  --warning: #f59e0b;  /* amber-500 */
  --danger:  #ef4444;  /* red-500 */

  /* Effects */
  --ring-outline: 0 0 0 3px var(--focus);
  --shadow-soft: 0 10px 30px rgba(0,0,0,0.28);

  color-scheme: dark;
}

@media (prefers-color-scheme: light) {
  /* Optional: keep dark-only for now; remove this block to support light */
}

/* ───────────────────────── Element defaults ───────────────────────── */
html, body {
  background: var(--bg);
  color: var(--fg);
  min-height: 100%;
}

html { @apply antialiased; }

* { -webkit-tap-highlight-color: transparent; }
a { text-decoration: none; color: inherit; }
::selection { background: rgba(236,72,153,0.35); }

/* Smooth scroll only if users didn't reduce motion */
html:where(:not([data-reduce-motion="true"])) { scroll-behavior: smooth; }

/* Scrollbar (no effect on iOS Safari; safe elsewhere) */
@layer base {
  *::-webkit-scrollbar { width: 10px; height: 10px; }
  *::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 9999px; }
  *::-webkit-scrollbar-track { background: transparent; }
}

/* Autofill fixes for inputs (keeps dark bg) */
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
  -webkit-text-fill-color: var(--fg);
  -webkit-box-shadow: 0 0 0px 1000px rgba(255,255,255,0.02) inset;
  caret-color: var(--fg);
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.001ms !important;
    scroll-behavior: auto !important;
  }
}

/* ───────────────────────── Layout helpers ───────────────────────── */
.container { @apply mx-auto max-w-6xl px-4; }
.stack-lg  { @apply space-y-8; }
.stack-md  { @apply space-y-6; }
.stack-sm  { @apply space-y-3; }

.actions-row { @apply flex flex-wrap gap-2; }

/* Safe-area padding helpers (iOS) */
.pad-safe-x { padding-left: max(1rem, env(safe-area-inset-left)); padding-right: max(1rem, env(safe-area-inset-right)); }
.pad-safe-t { padding-top: max(0.5rem, env(safe-area-inset-top)); }
.pad-safe-b { padding-bottom: max(0.5rem, env(safe-area-inset-bottom)); }

/* ───────────────────────── Components layer ───────────────────────── */
@layer components {
  .card {
    @apply rounded-2xl border p-6 shadow;
    background: var(--panel);
    border-color: var(--border);
    box-shadow: var(--shadow-soft);
  }

  .card-strong {
    @apply rounded-2xl border p-6 shadow;
    background: var(--panel-strong);
    border-color: var(--border-strong);
    box-shadow: var(--shadow-soft);
  }

  .badge {
    @apply inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs;
    border-color: var(--border);
    background: rgba(255,255,255,0.04);
  }
  .badge-primary  { @apply text-pink-200; border-color: color-mix(in oklab, var(--primary) 40%, transparent); background: var(--primary-weak); }
  .badge-success  { @apply text-green-200; border-color: #22c55e40; background: #22c55e1a; }
  .badge-warning  { @apply text-amber-200; border-color: #f59e0b40; background: #f59e0b1a; }
  .badge-muted    { @apply text-zinc-300; }

  .pill {
    @apply inline-flex items-center rounded-full border px-3 py-1 text-xs;
    border-color: var(--border);
  }

  /* Buttons */
  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2 text-sm font-medium transition;
    @apply border hover:bg-white/10 focus:outline-none focus-visible:ring-2;
    border-color: var(--border);
    box-shadow: 0 0 0 0 rgba(236, 72, 153, 0);
    will-change: transform, background-color, box-shadow;
  }
  .btn:focus-visible { box-shadow: var(--ring-outline); }
  .btn:disabled { @apply opacity-50 cursor-not-allowed; }

  .btn-primary   { @apply border-pink-500/60 hover:bg-pink-500/10; }
  .btn-secondary { @apply border-white/15 hover:bg-white/10; }
  .btn-danger    { @apply border-red-500/50 hover:bg-red-500/10; }
  .btn-ghost     { @apply border-transparent hover:bg-white/10; }

  .btn-icon {
    @apply inline-flex items-center justify-center rounded-xl p-2 border;
    border-color: var(--border);
  }

  /* Loading spinner adornment for buttons (add .is-loading on the element) */
  .btn.is-loading { @apply relative pointer-events-none opacity-80; }
  .btn.is-loading::after {
    content: "";
    position: absolute;
    right: 0.75rem; top: 50%; transform: translateY(-50%);
    width: 16px; height: 16px; border-radius: 9999px;
    border: 2px solid rgba(255,255,255,0.25);
    border-top-color: #fff;
    animation: spin 0.9s linear infinite;
  }

  /* Inputs */
  input, textarea, select {
    @apply w-full rounded-xl border bg-black/40 px-3 py-2 outline-none transition;
    border-color: var(--border);
  }
  input:focus, textarea:focus, select:focus {
    @apply ring-2;
    --tw-ring-color: var(--focus);
  }
  input::placeholder, textarea::placeholder { color: color-mix(in oklab, var(--muted) 86%, #000 14%); }
  label { @apply text-sm opacity-80; }

  /* Input states */
  .input-error   { @apply border-red-500/50; }
  .input-success { @apply border-green-500/40; }

  /* Divider */
  .divider { @apply my-2 h-px w-full bg-white/10; }

  /* Skeletons */
  .skeleton      { @apply animate-pulse rounded-md bg-white/10; }
  .skeleton-line { @apply h-4 w-32 rounded bg-white/10; }
  .skeleton-box  { @apply h-24 w-full rounded-xl bg-white/10; }

  /* Avatar backdrop helper */
  .avatar-backdrop {
    @apply rounded-full ring-1 ring-white/10 bg-gradient-to-br from-white/5 to-white/0;
  }

  /* Focus-visible helper for key-only focus */
  .focus-ring { outline: none; }
  .focus-ring:focus-visible { box-shadow: var(--ring-outline); }
}

/* ───────────────────────── Utilities layer ───────────────────────── */
@layer utilities {
  .text-muted { color: var(--muted); }
  .ring-focus { box-shadow: var(--ring-outline); }

  /* Line-clamp helpers */
  .clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
  .clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

  /* Content width helpers */
  .prose-card { @apply max-w-3xl; }

  /* Nice grid that auto-fits cards */
  .auto-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 260px), 1fr));
    gap: 1rem;
  }

  /* Backdrop blur utility if supported */
  .backdrop-panel {
    background: var(--panel);
  }
  @supports (backdrop-filter: blur(8px)) {
    .backdrop-panel {
      background: rgba(10,10,12,0.55);
      backdrop-filter: blur(8px);
    }
  }
}

/* ───────────────────────── Keyframes ───────────────────────── */
@keyframes spin { to { transform: rotate(360deg); } }
